<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Оплата товаров</h1>
  <form id="payment-form">
    <label for="item">Выберите товар:</label>
    <div id="items">
      <div>
        <label>Розовый:</label>
        <input type="number" id="pink" min="0" value="0">
      </div>
      <div>
        <label>Черный:</label>
        <input type="number" id="black" min="0" value="0">
      </div>
      <div>
        <label>Белый:</label>
        <input type="number" id="white" min="0" value="0">
      </div>
    </div>
    <label for="delivery">Выберите доставку:</label>
    <select id="delivery">
      <option value="89">Чешская почта - 89 крон</option>
      <option value="149">Засилковня - 149 крон</option>
      <option value="149">ДПД - 149 крон</option>
    </select>
    <div id="card-element"><!-- Stripe Elements появится здесь --></div>
    <button type="submit">Оплатить</button>
    <div id="error-message"></div>
  </form>

  <script>
    const stripe = Stripe('pk_live_51QTu9SFa6asb2J8MYB3Fjp7SQqjeCW7aGke3iQ0b8Yllopms5ZN4DTZFRTvMCcujz9lcoPsUWt8S8zXcOeUCmMKV00oC8qeM25');
    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');

    document.getElementById('payment-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const pink = document.getElementById('pink').value;
      const black = document.getElementById('black').value;
      const white = document.getElementById('white').value;
      const delivery = document.getElementById('delivery').value;

      const items = [
        { color: 'pink', quantity: parseInt(pink) || 0 },
        { color: 'black', quantity: parseInt(black) || 0 },
        { color: 'white', quantity: parseInt(white) || 0 }
      ];

      const response = await fetch('/create-payment-intent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ items, delivery: parseInt(delivery) })
      });

      const { clientSecret } = await response.json();

      const { error } = await stripe.confirmCardPayment(clientSecret, {
        payment_method: { card: card }
      });

      if (error) {
        document.getElementById('error-message').innerText = error.message;
      } else {
        alert('Платеж успешно завершен!');
      }
    });
  </script>
</body>
</html>
